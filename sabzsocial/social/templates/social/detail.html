<div class="post" data-post-id="{{post.id}}">
   {{ post.description | linebreaks }}
   Published at {{ post.created }} by {{ post.author }}
   <button class="like_button">
       {% if request.user in post.likes.all %}
           Unlike
       {% else %}
           Like
       {% endif %}
   </button>
   <span class="likes-count">{{ post.likes.count }}</span> Likes
</div>

<!-- Tags -->
{% for tag in post.tags.all %}
   <a href="{% url 'social:post_list_by_tag' tag.slug %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
{% endfor %}

<!-- Similar Posts -->
<h2>Similar Posts</h2>
{% for post in similar_post %}
<p>
   <a href="{{ post.get_absolute_url }}">{{ post.description|truncatewords:10 }}</a>
</p>
{% empty %}
   There are no similar posts.
{% endfor %}

<!-- CSRF meta tag -->
<meta name="csrf-token" content="{{ csrf_token }}">

<!-- jQuery -->
<script
  src="https://code.jquery.com/jquery-3.7.1.js"
  integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
  crossorigin="anonymous"></script>

<!-- AJAX Like -->
<script>
    $(document).ready(function(){
        $('.like_button').click(function(){
            var post_id = $(this).closest('.post').data('post-id');
            var button = $(this);
            var likesCountSpan = button.closest('.post').find('.likes-count');
            var csrfToken = $('meta[name="csrf-token"]').attr('content');

            $.ajax({
                type: 'POST',
                url: "{% url 'social:like_post' %}",
                data: {
                    'post_id': post_id,
                    'csrfmiddlewaretoken': csrfToken
                },
                success: function(data){
                    if (data.liked){
                        button.text('Unlike');
                    } else {
                        button.text('Like');
                    }
                    likesCountSpan.text(data.likes_count);
                }
            });
        });
    });
</script>
